---
layout: post
title: 更换git托管，如何迁移原git仓库
---

之前某个项目因为特殊原因，需要从```github```迁移到```bitbucket```，有些注意需要需要在这里记录一下。

## 创建```SSH key```

如果当前的```bitbucket```账号跟```github```是一样的，则直接将对应的公匙copy到```bitbucket```上面即可。一般来说，以Mac为例，公匙一般是放在```~/.ssh/```目录的：

	//进入.ssh目录
	cd ~/.ssh/

	//查看目录文件
	ls

	//查看指定公匙内容
	cat is_rsa.pub


```.pub```文件里面的内容就是公匙了，而同名的则是私匙。公匙是放到```github```或者```bitbucket```上面的，如果```bitbucket```跟```github```的账号不一样，则需要创建一个新的了：

	//创建一个新的ssh key
	ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
	//在回车后，需要输入一个全新的ssk key名字，比如我现在输入的是tx-fe，然后一直enter到结束即可

	//查看刚刚创建的ssh key，比如我刚才创建的tx-fe
	//cat tx-fe.pub

	//将tx-fe.pub的内容copy到bitbucket后，需要在将ssh key添加到know_hosts里面
	ssh-add ~/.ssh/tx-fe


当上面的创建步骤操作完成后，即可使用新的```SSH key```了。

还有点需要注意，就是上面提到的，```bitbucket```跟```github```全局用户名不一样的情况！
比如我现在Mac在第一次使用```github```的时候，使用的是```harrischen```这个全局用户名，但这回```bitbucket```使用的是```tx-fe```。这时，在项目的```.git/config```里面，需要重新设置用户名了：

	//查看全局git配置
	cat ~/.gitconfig
	//这个时候，应该能看到类似这样的配置：
	[user]
		name = harrischen
		email = xxoo@qq.com

	//在项目当中使用新的用户名
	git config user.name "tx-fe"
	git config user.email "your_email@example.com"
	//注意：这里的email需要跟刚才创建ssh key的时候一致

这样，一台电脑就可以有多个```github```或者```bitbucket```账号了～！


## 修改原有的git托管

在修改git托管之前，需要先将本地的修改全部```commit```，并不一定需要```push```。然后修改```remote origin```：

	//删掉原来git源
	git remote remove origin

	//将新源地址写入本地版本库配置文件
	git remote add origin git@bitbucket.org:tx-fe/jingo.git

	//测试一下新仓库是否被更新
	git pull origin harrischen

完成上面的操作后，就等于后面的push操作都会被推送到新的仓库里面去了；

当然，也可以直接修改项目目录下的```.git/config```文件来达到效果，比如：


	//进入项目
	cd projectName

	//编辑.git/config文件
	vi .git/config

	//假设修改后的.git/config文件内容是这样的：
	[core]
		repositoryformatversion = 0
		filemode = true
		bare = false
		logallrefupdates = true
		ignorecase = true
		precomposeunicode = false
	[remote "origin"]
		#url = git@github.com:nornor/jingo.git（注意这里的修改处）
		url = git@bitbucket.org:tx-fe/jingo.git
		fetch = +refs/heads/*:refs/remotes/origin/*
	[branch "master"]
		remote = origin
		merge = refs/heads/master
	[branch "v2"]
		remote = origin
		merge = refs/heads/v2
	[branch "harrischen"]
		remote = origin
		merge = refs/heads/harrischen
	[branch "dev"]
		remote = origin
		merge = refs/heads/dev

修改后，可进行相应的测试来验证是否成功。比如，查看远程仓库是否使用新地址：

	git remote -v
	//正确情况下，应该能看到以下信息
	origin	git@bitbucket.org:tx-fe/jingo.git (fetch)
	origin	git@bitbucket.org:tx-fe/jingo.git (push)


